/* 
  Component: Sticky Note
  統一的便利貼樣式系統
  
  使用 % 與 cqw（container query）確保各頁面比例一致：
  - 容器尺寸可不同（editor 600px、home 400px、display 600px）
  - 內部的 padding、字體、貼紙大小皆為容器的比例
*/

/* Mixins：供 editor 等頁面共用比例 */

/** 文字區塊寬度：max-content + 換行只與 scale 有關（視覺寬 80cqw），editor 與 display 共用 */
@mixin sticky-note-text-block-width {
  width: max-content;
  max-width: calc(80cqw / var(--text-scale, 1));
}

@mixin sticky-note-font-size {
  font-size: calc(var(--font-size-pct, 4) * 1cqw);
  line-height: 1.6;
  white-space: pre-wrap;
}

@mixin sticky-note-sticker-size {
  font-size: calc(var(--font-size-pct, 4) * 2 * 1cqw);
  width: calc(var(--font-size-pct, 4) * 2 * 1cqw);
  height: calc(var(--font-size-pct, 4) * 2 * 1cqw);
}

@mixin sticky-note-sticker-img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* 便利貼圖層順序（editor 與 display 一致）：文字 1 → 手繪 2 → 貼紙 3 */
@mixin sticky-note-layer-text {
  z-index: 1;
}

@mixin sticky-note-layer-drawing {
  z-index: 2;
}

@mixin sticky-note-layer-sticker {
  z-index: 3;
}

.c-sticky-note {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;

  /* 啟用 container query，讓內部可使用 cqw 單位 */
  container-type: inline-size;
  container-name: sticky-note;

  /* 
    擬真陰影效果（真實便利貼物理感）：
    因為上方有背膠黏死，下方微微翹起，所以陰影重心必須偏下。
    - 第一層：模擬整張紙0.1mm厚度緊貼牆壁的極細邊緣暗角
    - 第二層：模擬下方紙張翹起，所產生的縱向漸層陰影
  */
  filter:
    drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05)) drop-shadow(0 8px 12px rgba(0, 0, 0, 0.15));
  will-change: filter, transform;
  transform: translateZ(0);
  /* 提升硬體加速，防止 Safari 邊緣毛邊 */

  /* 內層：形狀由外層 mask-image 控制、背景圖片 */
  &__inner {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 8%;
    overflow: hidden;

    /* 
      擬真紙張光影疊加層（模擬背膠與紙張彎曲）：
      真實的便利貼上方 15% 處有一條背膠的物理分界，
      下方因為沒有黏性而稍微翹起迎光，底部邊緣再轉暗。
    */
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      /* 由上到下的物理打光：極度柔化的薄霧光效，模擬真實無亮面紙張 */
      background: linear-gradient(to bottom,
          rgba(0, 0, 0, 0.02) 0%,
          rgba(0, 0, 0, 0.03) 15%,
          rgba(255, 255, 255, 0.06) 25%,
          rgba(255, 255, 255, 0) 60%,
          rgba(0, 0, 0, 0.04) 100%);
      mix-blend-mode: normal;
    }
  }

  /* 內容文字外包裝 - 支援位置、縮放、旋轉 */
  &__content-wrap {
    position: absolute;
    @include sticky-note-layer-text;
    transform-origin: center center;
  }

  /* 內容文字區域 - 換行寬度只與 scale 有關，與 editor 共用 mixin */
  &__content {
    @include sticky-note-text-block-width;
    word-break: break-word;
    @include sticky-note-font-size;
  }

  /* 貼紙元素 - 大小為文字的 2 倍（與 editor 基準一致：2em） */
  &__sticker {
    position: absolute;
    @include sticky-note-sticker-size;
    @include sticky-note-layer-sticker;
    pointer-events: none;
    user-select: none;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;

    &-img {
      @include sticky-note-sticker-img;
    }
  }

  /* 手繪圖層 */
  &__drawing {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
    user-select: none;
    @include sticky-note-layer-drawing;
  }
}

/*
  響應式：只需調整容器尺寸，不需調整內部比例
  內部使用 % / cqw 會自動跟著縮放
*/
@media (max-width: 768px) {
  .c-sticky-note {
    max-width: 100%;
  }
}

/*
  便利貼容器變體
  用於不同頁面的尺寸設定
*/
/* Home 牆面 - 400px 基準，比例與 editor/display 一致（內部用 %） */
.c-sticky-note-container--wall {
  max-width: 400px;
  width: 100%;
  margin: 0 auto;
}

/* Display 大螢幕 - 600px 基準 */
.c-sticky-note-container--display {
  max-width: 600px;
  width: 100%;
  margin: 0 auto;
}